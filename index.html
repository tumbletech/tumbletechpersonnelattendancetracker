<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tumbletech Attendance Portal</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #f0f2f5;
    }
    .card {
      max-width: 600px;
      margin: auto;
      margin-top: 6%;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      border-radius: 10px;
    }
    .section-title {
      font-weight: 600;
      margin-bottom: 10px;
    }
  </style>
</head>

<body>

<!-- ðŸ”’ LOGIN GUARD -->
<script>
if (!localStorage.getItem("userID")) {
  window.location.href = "login.html";
}
</script>

<!-- ðŸ•’ CLOCKS -->
<div class="position-fixed top-0 end-0 p-3 text-end">
  <div class="fw-bold">Local Time</div>
  <div id="localClock" class="fs-5"></div>

  <div class="fw-bold mt-2">Work Time</div>
  <div id="workClock" class="fs-5"></div>
</div>

<div class="container">
  <div class="card">
    <div class="card-header bg-dark text-white text-center fw-bold fs-5">
      Employee Dashboard
    </div>

    <div class="card-body">

      <!-- ðŸ‘¤ WELCOME -->
      <h5 class="text-center mb-4">
        Welcome, <span id="empName"></span>
      </h5>

      <!-- ðŸ•’ ATTENDANCE -->
      <div class="mb-4">
        <div class="section-title">Attendance</div>

        <button class="btn btn-success w-100 mb-2" onclick="logAttendance('TIME_IN')">
          Time In
        </button>

        <button class="btn btn-danger w-100" onclick="logAttendance('TIME_OUT')">
          Time Out
        </button>

        <div id="lastAction" class="mt-2 text-muted text-center"></div>
      </div>

      <!-- ðŸŒ´ LEAVE BALANCE -->
      <div class="mb-4">
        <div class="section-title">Leave Balance</div>
        <ul class="list-group">
          <li class="list-group-item d-flex justify-content-between">
            Vacation Leave <span id="vacLeave">7</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            Sick Leave <span id="sickLeave">5</span>
          </li>
        </ul>
      </div>

      <!-- ðŸ“ FILE LEAVE -->
      <div class="mb-4">
        <div class="section-title">File Leave</div>

        <select id="leaveType" class="form-select mb-2">
          <option value="Vacation">Vacation</option>
          <option value="Sick">Sick</option>
          <option value="Emergency">Emergency</option>
        </select>

        <input type="date" id="leaveFrom" class="form-control mb-2">
        <input type="date" id="leaveTo" class="form-control mb-2">

        <textarea id="leaveNote" class="form-control mb-2" placeholder="Optional note"></textarea>

        <button class="btn btn-primary w-100" onclick="submitLeave()">
          Submit Leave Request
        </button>
      </div>

      <!-- ðŸ“‹ MY LEAVE REQUESTS -->
      <div class="mb-4">
        <div class="section-title">My Leave Requests</div>

        <ul id="leaveList" class="list-group">
          <li class="list-group-item">
            Dec 30â€“31 | Vacation | <span class="badge bg-warning text-dark">Pending</span>
          </li>
          <li class="list-group-item">
            Jan 5 | Sick | <span class="badge bg-success">Approved</span>
          </li>
        </ul>
      </div>

      <!-- ðŸšª LOGOUT -->
      <button class="btn btn-outline-secondary w-100" onclick="logout()">
        Logout
      </button>

    </div>
  </div>
</div>

<script>
/* ðŸ‘¤ USER */
document.getElementById("empName").innerText =
  localStorage.getItem("fullName");

/* ðŸ•’ CLOCKS */
const WORK_TIMEZONE = "Asia/Manila";

function updateClocks() {
  const now = new Date();

  document.getElementById("localClock").innerText =
    now.toLocaleTimeString();

  document.getElementById("workClock").innerText =
    new Intl.DateTimeFormat("en-US", {
      timeZone: WORK_TIMEZONE,
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    }).format(now);
}

setInterval(updateClocks, 1000);
updateClocks();

/* ðŸ§¾ ATTENDANCE (placeholder for n8n) */
function logAttendance(action) {
  const now = new Date();

  const payload = {
    userID: localStorage.getItem("userID"),
    action: action,
    local_time: now.toLocaleTimeString(),
    work_time: document.getElementById("workClock").innerText,
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
  };

  console.log("Attendance:", payload);

  document.getElementById("lastAction").innerText =
    `Last action: ${action.replace('_',' ')} â€“ ${payload.work_time} (Work Time)`;
}

/* ðŸŒ´ LEAVE SUBMISSION (placeholder for n8n) */
function submitLeave() {
  const payload = {
    userID: localStorage.getItem("userID"),
    type: document.getElementById("leaveType").value,
    from: document.getElementById("leaveFrom").value,
    to: document.getElementById("leaveTo").value,
    note: document.getElementById("leaveNote").value,
    status: "Pending"
  };

  console.log("Leave Request:", payload);
  alert("Leave request submitted.");
}

/* ðŸšª LOGOUT */
function logout() {
  localStorage.clear();
  window.location.href = "login.html";
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tumbletech Attendance Portal</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #f0f2f5;
    }
    .card {
      max-width: 500px;
      margin: auto;
      margin-top: 8%;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      border-radius: 10px;
    }
  </style>
</head>

<body>

<!-- ðŸ”’ LOGIN GUARD -->
<script>
if (!localStorage.getItem("userID")) {
  window.location.href = "login.html";
}
</script>

<!-- ðŸ•’ CLOCKS -->
<div class="position-fixed top-0 end-0 p-3 text-end">
  <div class="fw-bold">Local Time</div>
  <div id="localClock" class="fs-5"></div>

  <div class="fw-bold mt-2">Work Time</div>
  <div id="workClock" class="fs-5"></div>
</div>

<div class="container">
  <div class="card">
    <div class="card-header bg-dark text-white text-center fw-bold fs-5">
      Attendance Tracker
    </div>

    <div class="card-body text-center">
      <h5 class="mb-3">
        Welcome, <span id="empName"></span>
      </h5>

      <button class="btn btn-success w-100 mb-2" onclick="logAttendance('TIME_IN')">
        Time In
      </button>

      <button class="btn btn-danger w-100 mb-2" onclick="logAttendance('TIME_OUT')">
        Time Out
      </button>

      <div id="lastAction" class="mt-3 text-muted"></div>

      <button class="btn btn-outline-secondary w-100 mt-4" onclick="logout()">
        Logout
      </button>
    </div>
  </div>
</div>

<script>
/* ðŸ‘¤ USER INFO */
document.getElementById("empName").innerText =
  localStorage.getItem("fullName");

/* ðŸ•’ CLOCK LOGIC */
const WORK_TIMEZONE = "Asia/Manila";

function updateClocks() {
  const now = new Date();

  document.getElementById("localClock").innerText =
    now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });

  document.getElementById("workClock").innerText =
    new Intl.DateTimeFormat("en-US", {
      timeZone: WORK_TIMEZONE,
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    }).format(now);
}

setInterval(updateClocks, 1000);
updateClocks();

/* ðŸ§¾ ATTENDANCE (placeholder â€“ wire to n8n next) */
function logAttendance(action) {
  const now = new Date();

  const localTime = now.toLocaleTimeString();
  const workTime = new Intl.DateTimeFormat("en-US", {
    timeZone: WORK_TIMEZONE,
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  }).format(now);

  document.getElementById("lastAction").innerText =
    `Last action: ${action.replace('_', ' ')} â€“ ${workTime} (Work Time)`;

  console.log({
    userID: localStorage.getItem("userID"),
    action: action,
    local_time: localTime,
    work_time: workTime,
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
  });
}

/* ðŸšª LOGOUT */
function logout() {
  localStorage.clear();
  window.location.href = "login.html";
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
